<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç³»çµ±æ¨¡çµ„é—œä¿‚åœ– - IoT æ°´ä½ç›£æ¸¬ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.jsdelivr.net/dist/html2canvas.min.js"></script>
    <style>
      body {
        font-family: "Microsoft JhengHei", Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .header {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: white;
        padding: 30px;
        text-align: center;
      }
      .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
      }
      .header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1em;
      }
      .controls {
        padding: 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
        text-align: center;
      }
      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        margin: 0 10px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      .btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }
      .btn.export {
        background: #e74c3c;
      }
      .btn.export:hover {
        background: #c0392b;
      }
      .diagram-container {
        padding: 40px;
        background: white;
        min-height: 800px;
      }
      .legend {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #3498db;
      }
      .legend h3 {
        margin: 0 0 15px 0;
        color: #2c3e50;
      }
      .legend-item {
        display: inline-block;
        margin: 5px 15px 5px 0;
        padding: 5px 10px;
        background: white;
        border-radius: 15px;
        font-size: 12px;
        border: 2px solid;
      }
      .core {
        border-color: #e74c3c;
        color: #e74c3c;
      }
      .management {
        border-color: #3498db;
        color: #3498db;
      }
      .config {
        border-color: #f39c12;
        color: #f39c12;
      }
      .audit {
        border-color: #9b59b6;
        color: #9b59b6;
      }
      .info-panel {
        margin-top: 30px;
        padding: 25px;
        background: linear-gradient(135deg, #74b9ff, #0984e3);
        color: white;
        border-radius: 15px;
      }
      .info-panel h3 {
        margin: 0 0 15px 0;
        font-size: 1.3em;
      }
      .module-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }
      .module-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-left: 4px solid;
      }
      .module-card h4 {
        margin: 0 0 10px 0;
        font-size: 1.1em;
      }
      .module-card p {
        margin: 0;
        font-size: 0.9em;
        color: #666;
        line-height: 1.5;
      }
      @media (max-width: 768px) {
        .container {
          margin: 0;
          border-radius: 0;
        }
        .header h1 {
          font-size: 2em;
        }
        .diagram-container {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸŒŠ IoT æ°´ä½ç›£æ¸¬ç³»çµ± - ç³»çµ±æ¨¡çµ„é—œä¿‚åœ–</h1>
        <p>Community Water Level IoT Frontend - System Architecture Diagram</p>
      </div>

      <div class="controls">
        <button class="btn" onclick="showOverview()">ğŸ“Š ç³»çµ±ç¸½è¦½</button>
        <button class="btn" onclick="showDetailed()">ğŸ” è©³ç´°é—œä¿‚åœ–</button>
        <button class="btn" onclick="showDataFlow()">âš¡ è³‡æ–™æµç¨‹åœ–</button>
        <button class="btn export" onclick="exportToPDF()">ğŸ“„ åŒ¯å‡º PDF</button>
      </div>

      <div class="diagram-container" id="diagram-container">
        <div id="mermaid-diagram"></div>
      </div>

      <div class="legend">
        <h3>ğŸ·ï¸ åœ–ä¾‹èªªæ˜</h3>
        <span class="legend-item core">æ ¸å¿ƒç®¡ç†æ¨¡çµ„</span>
        <span class="legend-item management">æ¬Šé™ç®¡ç†æ¨¡çµ„</span>
        <span class="legend-item config">ç³»çµ±é…ç½®æ¨¡çµ„</span>
        <span class="legend-item audit">ç¨½æ ¸ç›£æ§æ¨¡çµ„</span>
      </div>

      <div class="info-panel">
        <h3>ğŸ“‹ ç³»çµ±æ¨¡çµ„èªªæ˜</h3>
        <div class="module-grid">
          <div class="module-card" style="border-left-color: #e74c3c">
            <h4>ğŸ‘¥ ä½¿ç”¨è€…ç®¡ç† (User Management)</h4>
            <p>
              è² è²¬ä½¿ç”¨è€…å¸³è™Ÿçš„å®Œæ•´ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ŒåŒ…å«å¸³è™Ÿå»ºç«‹ã€æ¬Šé™åˆ†é…ã€ç‹€æ…‹ç®¡ç†å’Œéƒ¨é–€æ­¸å±¬ã€‚èˆ‡è§’è‰²ç®¡ç†å’Œéƒ¨é–€ç®¡ç†å¯†åˆ‡ç›¸é—œã€‚
            </p>
          </div>
          <div class="module-card" style="border-left-color: #3498db">
            <h4>ğŸ­ è§’è‰²ç®¡ç† (Role Management)</h4>
            <p>
              å¯¦ç¾åŸºæ–¼è§’è‰²çš„å­˜å–æ§åˆ¶(RBAC)ï¼Œç®¡ç†è§’è‰²å®šç¾©ã€æ¬Šé™åˆ†é…å’Œè³‡æ–™ç¯„åœæ§åˆ¶ã€‚æ˜¯æ•´å€‹æ¬Šé™ç³»çµ±çš„æ ¸å¿ƒã€‚
            </p>
          </div>
          <div class="module-card" style="border-left-color: #3498db">
            <h4>ğŸ“‹ é¸å–®ç®¡ç† (Menu Management)</h4>
            <p>
              ç®¡ç†ç³»çµ±å°èˆªçµæ§‹å’ŒåŠŸèƒ½é¸å–®ï¼Œæ§åˆ¶ä½¿ç”¨è€…ä»‹é¢çš„å‘ˆç¾å’ŒåŠŸèƒ½å­˜å–æ¬Šé™ã€‚èˆ‡è§’è‰²æ¬Šé™ç·Šå¯†æ•´åˆã€‚
            </p>
          </div>
          <div class="module-card" style="border-left-color: #e74c3c">
            <h4>ğŸ¢ éƒ¨é–€ç®¡ç† (Department Management)</h4>
            <p>ç®¡ç†çµ„ç¹”æ¶æ§‹å’Œéƒ¨é–€å±¤ç´šé—œä¿‚ï¼Œæ”¯æ´æ°´ä½ç›£æ¸¬ç«™é»çš„åœ°ç†å€åŸŸåŠƒåˆ†å’Œç®¡ç†éšå±¤ã€‚</p>
          </div>
          <div class="module-card" style="border-left-color: #f39c12">
            <h4>ğŸ“š å­—å…¸ç®¡ç† (Dictionary Management)</h4>
            <p>ç¶­è­·ç³»çµ±åŸºç¤è³‡æ–™å’Œä»£ç¢¼è¡¨ï¼Œæä¾›ä¸‹æ‹‰é¸é …ã€ç‹€æ…‹ä»£ç¢¼ç­‰ç³»çµ±é…ç½®è³‡æ–™çš„é›†ä¸­ç®¡ç†ã€‚</p>
          </div>
          <div class="module-card" style="border-left-color: #f39c12">
            <h4>âš™ï¸ ç³»çµ±è¨­å®š (System Configuration)</h4>
            <p>ç®¡ç†ç³»çµ±åƒæ•¸é…ç½®ï¼ŒåŒ…å«åŠŸèƒ½é–‹é—œã€é è¨­å€¼è¨­å®šå’Œç³»çµ±è¡Œç‚ºé…ç½®åƒæ•¸ã€‚</p>
          </div>
          <div class="module-card" style="border-left-color: #9b59b6">
            <h4>ğŸ“¢ å…¬å‘Šç®¡ç† (Notice Management)</h4>
            <p>ç®¡ç†ç³»çµ±å…¬å‘Šå’Œé€šçŸ¥ï¼Œæ”¯æ´å¯Œæ–‡æœ¬ç·¨è¼¯ã€ç™¼å¸ƒæ§åˆ¶å’Œç›®æ¨™ä½¿ç”¨è€…è¨­å®šã€‚</p>
          </div>
          <div class="module-card" style="border-left-color: #9b59b6">
            <h4>ğŸ“Š ç³»çµ±æ—¥èªŒ (System Log)</h4>
            <p>è¨˜éŒ„å’ŒæŸ¥è©¢ç³»çµ±æ“ä½œæ—¥èªŒï¼Œæä¾›ç¨½æ ¸è»Œè·¡ã€æ•ˆèƒ½ç›£æ§å’Œå®‰å…¨è¿½è¹¤åŠŸèƒ½ã€‚</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Mermaid
      mermaid.initialize({
        startOnLoad: false,
        theme: "default",
        themeVariables: {
          primaryColor: "#3498db",
          primaryTextColor: "#2c3e50",
          primaryBorderColor: "#2980b9",
          lineColor: "#34495e",
          secondaryColor: "#ecf0f1",
          tertiaryColor: "#bdc3c7",
        },
      });

      // System Overview Diagram
      const overviewDiagram = `
            graph TB
                subgraph "ğŸŒŠ IoT æ°´ä½ç›£æ¸¬ç³»çµ± Frontend"
                    subgraph "æ ¸å¿ƒç®¡ç†æ¨¡çµ„"
                        User["ğŸ‘¥<br/>ä½¿ç”¨è€…ç®¡ç†<br/>(User Management)"]
                        Dept["ğŸ¢<br/>éƒ¨é–€ç®¡ç†<br/>(Department Management)"]
                    end
                    
                    subgraph "æ¬Šé™ç®¡ç†æ¨¡çµ„"
                        Role["ğŸ­<br/>è§’è‰²ç®¡ç†<br/>(Role Management)"]
                        Menu["ğŸ“‹<br/>é¸å–®ç®¡ç†<br/>(Menu Management)"]
                    end
                    
                    subgraph "ç³»çµ±é…ç½®æ¨¡çµ„"
                        Dict["ğŸ“š<br/>å­—å…¸ç®¡ç†<br/>(Dictionary Management)"]
                        Config["âš™ï¸<br/>ç³»çµ±è¨­å®š<br/>(System Configuration)"]
                    end
                    
                    subgraph "ç¨½æ ¸ç›£æ§æ¨¡çµ„"
                        Notice["ğŸ“¢<br/>å…¬å‘Šç®¡ç†<br/>(Notice Management)"]
                        Log["ğŸ“Š<br/>ç³»çµ±æ—¥èªŒ<br/>(System Log)"]
                    end
                end

                %% Core relationships
                User -->|ä¾æ“šéƒ¨é–€| Dept
                User -->|åˆ†é…è§’è‰²| Role
                Role -->|æ§åˆ¶é¸å–®æ¬Šé™| Menu
                Role -->|è³‡æ–™ç¯„åœæ§åˆ¶| Dept
                
                %% Configuration dependencies
                Dict -->|æä¾›é¸é …è³‡æ–™| User
                Dict -->|æä¾›é¸é …è³‡æ–™| Role
                Dict -->|æä¾›é¸é …è³‡æ–™| Notice
                Config -->|ç³»çµ±åƒæ•¸| User
                Config -->|ç³»çµ±åƒæ•¸| Role
                
                %% Audit trail
                Log -->|è¨˜éŒ„æ“ä½œ| User
                Log -->|è¨˜éŒ„æ“ä½œ| Role
                Log -->|è¨˜éŒ„æ“ä½œ| Menu
                Log -->|è¨˜éŒ„æ“ä½œ| Dept
                Log -->|è¨˜éŒ„æ“ä½œ| Dict
                Log -->|è¨˜éŒ„æ“ä½œ| Config
                Log -->|è¨˜éŒ„æ“ä½œ| Notice

                %% Styling
                classDef coreModule fill:#ffebee,stroke:#e74c3c,stroke-width:2px
                classDef authModule fill:#e3f2fd,stroke:#3498db,stroke-width:2px
                classDef configModule fill:#fff3e0,stroke:#f39c12,stroke-width:2px
                classDef auditModule fill:#f3e5f5,stroke:#9b59b6,stroke-width:2px
                
                class User,Dept coreModule
                class Role,Menu authModule
                class Dict,Config configModule
                class Notice,Log auditModule
        `;

      // Detailed Relationship Diagram
      const detailedDiagram = `
            graph TB
                subgraph "å‰ç«¯é é¢çµ„ä»¶ (Frontend Components)"
                    UserView["src/views/system/user/index.vue<br/>ğŸ‘¥ ä½¿ç”¨è€…ç®¡ç†é é¢"]
                    RoleView["src/views/system/role/index.vue<br/>ğŸ­ è§’è‰²ç®¡ç†é é¢"]
                    MenuView["src/views/system/menu/index.vue<br/>ğŸ“‹ é¸å–®ç®¡ç†é é¢"]
                    DeptView["src/views/system/dept/index.vue<br/>ğŸ¢ éƒ¨é–€ç®¡ç†é é¢"]
                    DictView["src/views/system/dict/index.vue<br/>ğŸ“š å­—å…¸ç®¡ç†é é¢"]
                    ConfigView["src/views/system/config/index.vue<br/>âš™ï¸ ç³»çµ±è¨­å®šé é¢"]
                    NoticeView["src/views/system/notice/index.vue<br/>ğŸ“¢ å…¬å‘Šç®¡ç†é é¢"]
                    LogView["src/views/system/log/index.vue<br/>ğŸ“Š ç³»çµ±æ—¥èªŒé é¢"]
                end

                subgraph "API æœå‹™å±¤ (API Services)"
                    UserAPI["src/api/system/user-api.ts<br/>ä½¿ç”¨è€… API"]
                    RoleAPI["src/api/system/role-api.ts<br/>è§’è‰² API"]
                    MenuAPI["src/api/system/menu-api.ts<br/>é¸å–® API"]
                    DeptAPI["src/api/system/dept-api.ts<br/>éƒ¨é–€ API"]
                    DictAPI["src/api/system/dict-api.ts<br/>å­—å…¸ API"]
                    ConfigAPI["src/api/system/config-api.ts<br/>ç³»çµ±è¨­å®š API"]
                    NoticeAPI["src/api/system/notice-api.ts<br/>å…¬å‘Š API"]
                    LogAPI["src/api/system/log-api.ts<br/>æ—¥èªŒ API"]
                end

                subgraph "å…±ç”¨çµ„ä»¶ (Shared Components)"
                    DeptTree["src/views/system/user/components/DeptTree.vue<br/>éƒ¨é–€æ¨¹ç‹€é¸æ“‡å™¨"]
                    DictItem["src/views/system/dict/dict-item.vue<br/>å­—å…¸é …ç›®ç®¡ç†"]
                    MyNotice["src/views/system/notice/components/MyNotice.vue<br/>å€‹äººé€šçŸ¥ä¸­å¿ƒ"]
                end

                %% Page to API connections
                UserView --> UserAPI
                RoleView --> RoleAPI
                MenuView --> MenuAPI
                DeptView --> DeptAPI
                DictView --> DictAPI
                ConfigView --> ConfigAPI
                NoticeView --> NoticeAPI
                LogView --> LogAPI

                %% Shared component usage
                UserView --> DeptTree
                DictView --> DictItem
                NoticeView --> MyNotice

                %% Cross-module dependencies
                UserView -.->|æŸ¥è©¢éƒ¨é–€è³‡æ–™| DeptAPI
                UserView -.->|æŸ¥è©¢è§’è‰²è³‡æ–™| RoleAPI
                RoleView -.->|æŸ¥è©¢é¸å–®è³‡æ–™| MenuAPI
                RoleView -.->|æŸ¥è©¢éƒ¨é–€è³‡æ–™| DeptAPI
                MenuView -.->|æŸ¥è©¢çˆ¶é¸å–®| MenuAPI
                DeptView -.->|æŸ¥è©¢çˆ¶éƒ¨é–€| DeptAPI
                NoticeView -.->|ä½¿ç”¨å­—å…¸é¸é …| DictAPI
                
                %% Audit connections
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| UserAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| RoleAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| MenuAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| DeptAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| DictAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| ConfigAPI
                LogView -.->|è¨˜éŒ„æ‰€æœ‰æ“ä½œ| NoticeAPI

                %% Styling
                classDef pageComponent fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
                classDef apiService fill:#fff3e0,stroke:#ff9800,stroke-width:2px
                classDef sharedComponent fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
                
                class UserView,RoleView,MenuView,DeptView,DictView,ConfigView,NoticeView,LogView pageComponent
                class UserAPI,RoleAPI,MenuAPI,DeptAPI,DictAPI,ConfigAPI,NoticeAPI,LogAPI apiService
                class DeptTree,DictItem,MyNotice sharedComponent
        `;

      // Data Flow Diagram
      const dataFlowDiagram = `
            sequenceDiagram
                participant U as ğŸ‘¤ ä½¿ç”¨è€…
                participant F as ğŸ–¥ï¸ Frontend
                participant A as ğŸ”— API Layer
                participant B as ğŸ–¥ï¸ Backend
                participant D as ğŸ—„ï¸ Database

                Note over U,D: ä½¿ç”¨è€…ç™»å…¥èˆ‡æ¬Šé™é©—è­‰æµç¨‹
                U->>F: 1. ä½¿ç”¨è€…ç™»å…¥
                F->>A: 2. å‘¼å«èªè­‰ API
                A->>B: 3. é©—è­‰ä½¿ç”¨è€…å¸³å¯†
                B->>D: 4. æŸ¥è©¢ä½¿ç”¨è€…è³‡æ–™
                D-->>B: 5. å›å‚³ä½¿ç”¨è€…è³‡è¨Š
                B-->>A: 6. å›å‚³èªè­‰çµæœ
                A-->>F: 7. å›å‚³ JWT Token
                F-->>U: 8. ç™»å…¥æˆåŠŸ

                Note over U,D: æ¬Šé™é¸å–®è¼‰å…¥æµç¨‹
                U->>F: 9. é€²å…¥ç³»çµ±é¦–é 
                F->>A: 10. å–å¾—ä½¿ç”¨è€…é¸å–®æ¬Šé™
                A->>B: 11. æ ¹æ“šè§’è‰²æŸ¥è©¢é¸å–®
                B->>D: 12. æŸ¥è©¢è§’è‰²-é¸å–®é—œè¯
                D-->>B: 13. å›å‚³é¸å–®è³‡æ–™
                B-->>A: 14. å›å‚³æˆæ¬Šé¸å–®
                A-->>F: 15. å»ºæ§‹å°èˆªé¸å–®
                F-->>U: 16. é¡¯ç¤ºå€‹äººåŒ–é¸å–®

                Note over U,D: ç³»çµ±ç®¡ç†æ“ä½œæµç¨‹
                U->>F: 17. åŸ·è¡Œç®¡ç†æ“ä½œ
                F->>A: 18. å‘¼å«å°æ‡‰ API
                A->>B: 19. é©—è­‰æ“ä½œæ¬Šé™
                B->>D: 20. åŸ·è¡Œè³‡æ–™åº«æ“ä½œ
                D-->>B: 21. å›å‚³æ“ä½œçµæœ
                B->>D: 22. è¨˜éŒ„æ“ä½œæ—¥èªŒ
                B-->>A: 23. å›å‚³åŸ·è¡Œçµæœ
                A-->>F: 24. æ›´æ–°å‰ç«¯ç‹€æ…‹
                F-->>U: 25. é¡¯ç¤ºæ“ä½œçµæœ
        `;

      function showOverview() {
        renderDiagram(overviewDiagram);
      }

      function showDetailed() {
        renderDiagram(detailedDiagram);
      }

      function showDataFlow() {
        const container = document.getElementById("mermaid-diagram");
        container.innerHTML = `<div class="mermaid">${dataFlowDiagram}</div>`;
        mermaid.init(undefined, container.querySelector(".mermaid"));
      }

      function renderDiagram(diagramText) {
        const container = document.getElementById("mermaid-diagram");
        container.innerHTML = `<div class="mermaid">${diagramText}</div>`;
        mermaid.init(undefined, container.querySelector(".mermaid"));
      }

      async function exportToPDF() {
        const { jsPDF } = window.jspdf;

        // Show loading message
        const originalContent = document.getElementById("diagram-container").innerHTML;
        document.getElementById("diagram-container").innerHTML =
          '<div style="text-align: center; padding: 50px; font-size: 18px;">ğŸ”„ æ­£åœ¨ç”Ÿæˆ PDFï¼Œè«‹ç¨å€™...</div>';

        try {
          // Capture the entire container
          const element = document.querySelector(".container");
          const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: "#ffffff",
          });

          const imgData = canvas.toDataURL("image/png");
          const pdf = new jsPDF("l", "mm", "a4"); // landscape orientation

          const imgWidth = 297; // A4 landscape width in mm
          const pageHeight = 210; // A4 landscape height in mm
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          let heightLeft = imgHeight;

          let position = 0;

          // Add first page
          pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;

          // Add additional pages if needed
          while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }

          // Save the PDF
          const currentDate = new Date().toISOString().split("T")[0];
          pdf.save(`IoTæ°´ä½ç›£æ¸¬ç³»çµ±-æ¨¡çµ„é—œä¿‚åœ–-${currentDate}.pdf`);
        } catch (error) {
          console.error("Error generating PDF:", error);
          alert("PDF ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
        } finally {
          // Restore original content
          document.getElementById("diagram-container").innerHTML = originalContent;
          // Re-render the current diagram
          showOverview();
        }
      }

      // Initialize with overview diagram
      document.addEventListener("DOMContentLoaded", function () {
        showOverview();
      });
    </script>
  </body>
</html>
